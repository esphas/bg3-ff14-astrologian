
-- ========= 20 ========= --

local Progressions_20 = {
    -- Level 1
    ["1082e17b-47d2-47d4-8ad7-7dbeafab24ce"] = {
        PassivesAdded = "EK_FF14_Combust;EK_FF14_Malefic;EK_FF14_Benefic",
    },
    -- Level 1 (Multiclass)
    ["fcda32b0-fd13-4134-820e-693a7a35feb7"] = {
        PassivesAdded = "EK_FF14_Combust;EK_FF14_Malefic;EK_FF14_Benefic",
    },
    -- Level 2
    ["bd24afa6-b1c3-48c4-8687-6520856e764e"] = {
        Boosts = "ActionResource(EK_FF14_Arcana,3,0);ActionResource(EK_FF14_SwiftcastPoint,1,0)",
        PassivesAdded = "EK_FF14_ArcanaDraw;EK_FF14_ArcanaContinueBreak;EK_FF14_Swiftcast",
    },
    -- Level 3
    ["eb0ccd91-d299-444e-b0e6-61e782c04118"] = {
    },
    -- Level 3 - Diurnal Sect
    ["95c4a954-01fd-4d4d-85ee-534c17869bb2"] = {
        PassivesAdded = "EK_FF14_DiurnalSect_X;EK_FF14_DiurnalSect",
    },
    -- Level 3 - Nocturnal Sect
    ["1fb10f34-2a08-45d3-9dc7-69721aef2f54"] = {
        PassivesAdded = "EK_FF14_NocturnalSect_X;EK_FF14_NocturnalSect",
    },
    -- Level 4
    ["a10e8d5d-4ec2-48b4-b2f2-8120177ebc40"] = {
        PassivesAdded = "EK_FF14_ArcanaRedraw;EK_FF14_EssentialDignity",
    },
    -- Level 5
    ["66a7ee0a-ef1a-4801-8bdf-8e2f349735c6"] = {
        Boosts = "ActionResource(EK_FF14_Arcana,1,0)",
        PassivesAdded = "EK_FF14_ArcanaMinorArcana_6_0;EK_FF14_CombustPlus;EK_FF14_CombustII;EK_FF14_MaleficPlus;EK_FF14_MaleficII;EK_FF14_BeneficPlus;EK_FF14_BeneficII;EK_FF14_Gravity",
        PassivesRemoved = "EK_FF14_Combust;EK_FF14_Malefic;EK_FF14_Benefic",
    },
    -- Level 6
    ["1d2810df-aa1a-4474-ac74-6b23f7ecb682"] = {
        PassivesAdded = "EK_FF14_ArcanaSpread;EK_FF14_ArcanaUndrawSpread",
    },
    -- Level 7
    ["10c8cb55-fb52-4241-8cc3-8af59c8efee7"] = {
        PassivesAdded = "EK_FF14_AspectedHelios;EK_FF14_Surecast;EK_FF14_EssentialDignityPlus",
    },
    -- Level 8
    ["f256d918-173d-45d1-9c9b-1eaf9673b35a"] = {
        Boosts = "ActionResource(EK_FF14_Arcana,1,0)",
        PassivesAdded = "EK_FF14_ArcanaRoyalRoad;EK_FF14_ArcanaEmptyRoad",
    },
    -- Level 9
    ["006495ad-ad3e-4af4-ba83-563547885a9c"] = {
        PassivesAdded = "EK_FF14_MaleficPlusII;EK_FF14_MaleficIII",
        PassivesRemoved = "EK_FF14_MaleficII",
    },
    -- Level 10
    ["49d8a81c-0c39-481d-969b-95acc324d65e"] = {
        PassivesAdded = "EK_FF14_ArcanaSleeveDraw;EK_FF14_EssentialDignityPlusII",
    },
    -- Level 11
    ["3a960b97-ca93-473e-a3d7-d43bdac665fe"] = {
    },
    -- Level 12
    ["d014b42c-ca6d-4c6a-99b2-a8181d560e86"] = {
    },
    -- Level 13
    ["bbb80eb2-53d5-4670-b433-0c8ffc032bbe"] = {
        Boosts = "ActionResource(EK_FF14_Arcana,1,0)",
        PassivesAdded = "EK_FF14_CombustPlusII;EK_FF14_CombustIII;EK_FF14_MaleficPlusIII;EK_FF14_MaleficIV",
        PassivesRemoved = "EK_FF14_CombustII;EK_FF14_MaleficIII",
    },
    -- Level 14
    ["5aceaa78-d67a-48b0-af24-06fe80c770ab"] = {
        PassivesAdded = "EK_FF14_CelestialIntersection",
    },
    -- Level 15
    ["f5ee5f97-006f-4411-866b-7e7c6a7d9d23"] = {
        PassivesAdded = "EK_FF14_Horoscope",
    },
    -- Level 16
    ["7939f310-6fa8-40f6-9033-80dcbd933b18"] = {
        PassivesAdded = "EK_FF14_DivinationPlus",
    },
    -- Level 17
    ["0a15a32f-1222-492e-97e7-cb886f4d5723"] = {
        Boosts = "ActionResource(EK_FF14_Arcana,1,0)",
        PassivesAdded = "EK_FF14_MaleficPlusIV;EK_FF14_FallMalefic;EK_FF14_GravityPlus;EK_FF14_GravityII;EK_FF14_AspectedHeliosPlus;EK_FF14_HeliosConjunction",
        PassivesRemoved = "EK_FF14_MaleficIV;EK_FF14_Gravity;EK_FF14_AspectedHelios",
    },
    -- Level 18
    ["b639a138-c458-4caf-877e-187af8ec3efd"] = {
    },
    -- Level 19
    ["3b876984-9e95-41cb-ae68-0d85c07b83e2"] = {
    },
    -- Level 20
    ["a3eb752d-2ca4-4781-83e6-53a891305c78"] = {
        PassivesAdded = "EK_FF14_AstralStasis",
    },
}
local SpellLists_20 = {
    -- Level 1
    ["6524eec8-98c9-4456-b8f0-bfa637ec077a"] = {
        "Target_EK_FF14_Esuna",
    },
    -- Level 2
    ["5d0c1069-8f44-45a4-a40e-ba5aec3ba9f6"] = {
        "Shout_EK_FF14_Lightspeed",
        "Target_EK_FF14_TimeDilation",
    },
    -- Level 3
    ["fbdd2c01-fd62-4957-a427-7172954e6a9b"] = {
        "Target_EK_FF14_AspectedBenefic",
        "Shout_EK_FF14_Helios",
        "Teleportation_EK_FF14_Ascend",
    },
    -- Level 4
    ["524ba969-93e7-4f9a-8b20-2108853507c0"] = {
        "Target_EK_FF14_EssentialDignity",
        "Shout_EK_FF14_LucidDreaming",
    },
    -- Level 5
    ["8677b3b0-3ede-4f06-b125-be4a314de53e"] = {
    },
    -- Level 6
    ["5bafd978-3359-4f66-bdd6-b6f9d190dccc"] = {
        "Shout_EK_FF14_CelestialOpposition",
        "Shout_EK_FF14_CollectiveUnconscious",
    },
    -- Level 7
    ["bfda2f7a-675a-40e8-9115-7bff9c11c445"] = {
        "Shout_EK_FF14_Surecast",
        "Target_EK_FF14_Rescue",
    },
    -- Level 8
    ["fc16c4f7-e7a0-4085-8249-da513588f29e"] = {
        "Shout_EK_FF14_Divination",
        "Target_EK_FF14_EarthlyStar",
    },
    -- Level 9
    ["cf25d6a7-ce6a-446f-9696-5745f897d262"] = {
    },
    -- Level 10
    ["c418e842-bb8b-41db-98e8-0cfc05fd9c45"] = {
    },
    -- Level 11
    ["b76b0b87-3839-4229-bca5-77a2e0a40eef"] = {
        "Shout_EK_FF14_NeutralSect",
    },
    -- Level 12
    ["775a8af4-ea2e-4563-992c-2f3e4fd759b6"] = {
        "Shout_EK_FF14_CelestialRiver",
    },
    -- Level 13
    ["ebf08c55-e41e-4a29-a089-833a0ea94920"] = {
    },
    -- Level 14
    ["a2d85e8a-3f21-4acc-854f-94c437ffa569"] = {
    },
    -- Level 15
    ["a431b690-b61c-47ee-ab06-1d29703dc101"] = {
    },
    -- Level 16
    ["790f21a1-4152-4241-8b0f-a978dff82a21"] = {
    },
    -- Level 17
    ["db1fad64-bae7-43bc-a2ec-9d4c24369612"] = {
    },
    -- Level 18
    ["fa62d34d-552c-44ff-a67e-2607474bfd9c"] = {
        "Shout_EK_FF14_Macrocosmos",
    },
    -- Level 19
    ["54e099e2-e7c7-4420-b234-327a92679e65"] = {
    },
    -- Level 20
    ["9c3fc44e-abe8-4992-b268-4a683fff285a"] = {
    },
}


-- ========= 12 ========= --

local Progressions_12 = {
    -- Level 1
    ["1082e17b-47d2-47d4-8ad7-7dbeafab24ce"] = {
        PassivesAdded = "EK_FF14_Combust;EK_FF14_Malefic;EK_FF14_Benefic",
    },
    -- Level 1 (Multiclass)
    ["fcda32b0-fd13-4134-820e-693a7a35feb7"] = {
        PassivesAdded = "EK_FF14_Combust;EK_FF14_Malefic;EK_FF14_Benefic",
    },
    -- Level 2
    ["bd24afa6-b1c3-48c4-8687-6520856e764e"] = {
        Boosts = "ActionResource(EK_FF14_Arcana,3,0);ActionResource(EK_FF14_SwiftcastPoint,1,0)",
        PassivesAdded = "EK_FF14_ArcanaDraw;EK_FF14_ArcanaContinueBreak;EK_FF14_Swiftcast",
    },
    -- Level 3
    ["eb0ccd91-d299-444e-b0e6-61e782c04118"] = {
        PassivesAdded = "EK_FF14_ArcanaRedraw;EK_FF14_CombustPlus;EK_FF14_CombustII;EK_FF14_MaleficPlus;EK_FF14_MaleficII;EK_FF14_BeneficPlus;EK_FF14_BeneficII",
        PassivesRemoved = "EK_FF14_Combust;EK_FF14_Malefic;EK_FF14_Benefic",
    },
    -- Level 3 - Diurnal Sect
    ["95c4a954-01fd-4d4d-85ee-534c17869bb2"] = {
        PassivesAdded = "EK_FF14_DiurnalSect_X;EK_FF14_DiurnalSect",
    },
    -- Level 3 - Nocturnal Sect
    ["1fb10f34-2a08-45d3-9dc7-69721aef2f54"] = {
        PassivesAdded = "EK_FF14_NocturnalSect_X;EK_FF14_NocturnalSect",
    },
    -- Level 4
    ["a10e8d5d-4ec2-48b4-b2f2-8120177ebc40"] = {
        PassivesAdded = "EK_FF14_ArcanaMinorArcana_6_0;EK_FF14_EssentialDignity",
    },
    -- Level 5
    ["66a7ee0a-ef1a-4801-8bdf-8e2f349735c6"] = {
        Boosts = "ActionResource(EK_FF14_Arcana,1,0)",
        PassivesAdded = "EK_FF14_ArcanaSpread;EK_FF14_ArcanaUndrawSpread;EK_FF14_MaleficPlusII;EK_FF14_MaleficIII;EK_FF14_Gravity",
        PassivesRemoved = "EK_FF14_MaleficII",
    },
    -- Level 6
    ["1d2810df-aa1a-4474-ac74-6b23f7ecb682"] = {
        PassivesAdded = "EK_FF14_ArcanaRoyalRoad;EK_FF14_ArcanaEmptyRoad;EK_FF14_EssentialDignityPlus",
    },
    -- Level 7
    ["10c8cb55-fb52-4241-8cc3-8af59c8efee7"] = {
        PassivesAdded = "EK_FF14_CombustPlusII;EK_FF14_CombustIII;EK_FF14_MaleficPlusIII;EK_FF14_MaleficIV;EK_FF14_AspectedHelios;EK_FF14_Surecast",
        PassivesRemoved = "EK_FF14_CombustII;EK_FF14_MaleficIII",
    },
    -- Level 8
    ["f256d918-173d-45d1-9c9b-1eaf9673b35a"] = {
        Boosts = "ActionResource(EK_FF14_Arcana,1,0)",
        PassivesAdded = "EK_FF14_ArcanaSleeveDraw;EK_FF14_EssentialDignityPlusII",
    },
    -- Level 9
    ["006495ad-ad3e-4af4-ba83-563547885a9c"] = {
        PassivesAdded = "EK_FF14_CelestialIntersection;EK_FF14_Horoscope;EK_FF14_MaleficPlusIV;EK_FF14_FallMalefic;EK_FF14_GravityPlus;EK_FF14_GravityII;EK_FF14_AspectedHeliosPlus;EK_FF14_HeliosConjunction",
        PassivesRemoved = "EK_FF14_MaleficIV;EK_FF14_Gravity;EK_FF14_AspectedHelios",
    },
    -- Level 10
    ["49d8a81c-0c39-481d-969b-95acc324d65e"] = {
        PassivesAdded = "EK_FF14_DivinationPlus",
    },
    -- Level 11
    ["3a960b97-ca93-473e-a3d7-d43bdac665fe"] = {
    },
    -- Level 12
    ["d014b42c-ca6d-4c6a-99b2-a8181d560e86"] = {
        PassivesAdded = "EK_FF14_AstralStasis",
    },
}
local SpellLists_12 = {
    -- Level 1
    ["6524eec8-98c9-4456-b8f0-bfa637ec077a"] = {
        "Target_EK_FF14_Esuna",
    },
    -- Level 2
    ["5d0c1069-8f44-45a4-a40e-ba5aec3ba9f6"] = {
        "Shout_EK_FF14_Lightspeed",
        "Target_EK_FF14_TimeDilation",
    },
    -- Level 3
    ["fbdd2c01-fd62-4957-a427-7172954e6a9b"] = {
        "Target_EK_FF14_AspectedBenefic",
        "Shout_EK_FF14_Helios",
        "Teleportation_EK_FF14_Ascend",
    },
    -- Level 4
    ["524ba969-93e7-4f9a-8b20-2108853507c0"] = {
        "Target_EK_FF14_EssentialDignity",
        "Shout_EK_FF14_LucidDreaming",
    },
    -- Level 5
    ["8677b3b0-3ede-4f06-b125-be4a314de53e"] = {
        "Shout_EK_FF14_CelestialOpposition",
    },
    -- Level 6
    ["5bafd978-3359-4f66-bdd6-b6f9d190dccc"] = {
        "Shout_EK_FF14_CollectiveUnconscious",
        "Shout_EK_FF14_Divination",
    },
    -- Level 7
    ["bfda2f7a-675a-40e8-9115-7bff9c11c445"] = {
        "Shout_EK_FF14_Surecast",
        "Target_EK_FF14_Rescue",
        "Target_EK_FF14_EarthlyStar",
    },
    -- Level 8
    ["fc16c4f7-e7a0-4085-8249-da513588f29e"] = {
        "Shout_EK_FF14_NeutralSect",
    },
    -- Level 9
    ["cf25d6a7-ce6a-446f-9696-5745f897d262"] = {
    },
    -- Level 10
    ["c418e842-bb8b-41db-98e8-0cfc05fd9c45"] = {
        "Shout_EK_FF14_CelestialRiver",
    },
    -- Level 11
    ["b76b0b87-3839-4229-bca5-77a2e0a40eef"] = {
        "Shout_EK_FF14_Macrocosmos",
    },
    -- Level 12
    ["775a8af4-ea2e-4563-992c-2f3e4fd759b6"] = {
    },
}


-- ========= Apply ========= --

local function GetSettingValue(settingID, default)
    local MCM = "755a8a72-407f-4f0d-9a33-274ac0f0b53d"
    if Ext.Mod.IsModLoaded(MCM) then
        return Mods.BG3MCM.MCMAPI:GetSettingValue(settingID, ModuleUUID)
    else
        return default
    end
end

local function AstrologyProgressions()
    local choice = GetSettingValue("progression", "20")
    local progressions = choice == "20" and Progressions_20 or Progressions_12
    local spellLists = choice == "20" and SpellLists_20 or SpellLists_12
    for uuid, appendages in pairs(progressions) do
        local progression = Ext.StaticData.Get(uuid, "Progression")
        for id, value in pairs(appendages) do
            local newValue = value .. ";" .. progression[id]
            progression[id] = newValue
        end
    end
    for uuid, spells in pairs(spellLists) do
        local data = Ext.StaticData.Get(uuid, "SpellList").Spells
        local list = Ext.Types.Serialize(data)
        for _, spell in ipairs(spells) do
            table.insert(list, spell)
        end
        Ext.Types.Unserialize(data, list)
    end
end

Ext.Events.StatsLoaded:Subscribe(AstrologyProgressions)
